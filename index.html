<script>
  const yesBtn = document.getElementById('yesBtn');
  const noBtn = document.getElementById('noBtn');
  const sadMessage = document.getElementById('sadMessage');
  const yesMusic = document.getElementById('yesMusic');
  const noMusic = document.getElementById('noMusic');
  const emojiShower = document.getElementById('emojiShower');

  const slideshowImages = document.querySelectorAll('#slideshow img');
  let currentSlide = 0;
  setInterval(() => {
    slideshowImages[currentSlide].classList.remove('active');
    currentSlide = (currentSlide + 1) % slideshowImages.length;
    slideshowImages[currentSlide].classList.add('active');
  }, 4000);

  function sendResponse(answer) {
    fetch('https://formspree.io/f/manjqppd', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ message: answer })
    });
  }

  function showEmojiShower(emoji) {
    const burstCenterX = window.innerWidth / 2;
    const burstCenterY = window.innerHeight / 2;

    for (let i = 0; i < 30; i++) {
      const span = document.createElement('span');
      span.className = 'emoji';
      span.innerText = emoji;

      const angle = Math.random() * 2 * Math.PI;
      const radius = Math.random() * 300 + 50;

      const x = Math.cos(angle) * radius;
      const y = Math.sin(angle) * radius;

      span.style.left = `${burstCenterX}px`;
      span.style.top = `${burstCenterY}px`;
      span.style.setProperty('--x', `${x}px`);
      span.style.setProperty('--y', `${y}px`);
      span.style.fontSize = (Math.random() * 20 + 30) + 'px';

      emojiShower.appendChild(span);

      setTimeout(() => span.remove(), 2000);
    }
  }

  let emojiInterval = null;

  function startEmojiBurstDuringMusic(music, emoji1, emoji2) {
    emojiInterval = setInterval(() => {
      showEmojiShower(emoji1);
      showEmojiShower(emoji2);
    }, 1500);

    music.onended = () => {
      clearInterval(emojiInterval);
    };
  }

  yesBtn.addEventListener('click', () => {
    sadMessage.style.display = 'none';
    noMusic.pause(); noMusic.currentTime = 0;
    yesMusic.play();
    startFireworks();
    startEmojiBurstDuringMusic(yesMusic, '💐', '💖');
    sendResponse('Yes');
  });

  noBtn.addEventListener('click', () => {
    stopFireworks();
    sadMessage.style.display = 'block';
    yesMusic.pause(); yesMusic.currentTime = 0;
    noMusic.play();
    startEmojiBurstDuringMusic(noMusic, '😢', '😭');
    sendResponse('No');
  });

  const fireworksCanvas = document.getElementById('fireworks');
  const ctx = fireworksCanvas.getContext('2d');
  fireworksCanvas.width = window.innerWidth;
  fireworksCanvas.height = window.innerHeight;

  class Particle {
    constructor(x, y, color) {
      this.x = x;
      this.y = y;
      this.color = color;
      this.radius = Math.random() * 3 + 2;
      this.speedX = (Math.random() - 0.5) * 6;
      this.speedY = (Math.random() - 0.5) * 6;
      this.alpha = 1;
      this.decay = Math.random() * 0.01 + 0.005;
    }
    update() {
      this.x += this.speedX;
      this.y += this.speedY;
      this.alpha -= this.decay;
    }
    draw() {
      ctx.save();
      ctx.globalAlpha = this.alpha;
      ctx.beginPath();
      ctx.arc(this.x, this.y, this.radius, 0, Math.PI * 2);
      ctx.fillStyle = this.color;
      ctx.fill();
      ctx.restore();
    }
  }

  let particles = [];
  let animationId;

  function randomColor() {
    const colors = ['#ff4081', '#f50057', '#ff80ab', '#f48fb1', '#e91e63'];
    return colors[Math.floor(Math.random() * colors.length)];
  }

  function createFireworks() {
    for (let i = 0; i < 50; i++) {
      particles.push(new Particle(
        Math.random() * fireworksCanvas.width,
        Math.random() * fireworksCanvas.height * 0.6 + fireworksCanvas.height * 0.2,
        randomColor()
      ));
    }
  }

  function animate() {
    ctx.clearRect(0, 0, fireworksCanvas.width, fireworksCanvas.height);
    particles.forEach((p, i) => {
      p.update();
      if (p.alpha <= 0) particles.splice(i, 1);
      else p.draw();
    });
    if (particles.length === 0) {
      cancelAnimationFrame(animationId);
      fireworksCanvas.style.display = 'none';
    } else {
      animationId = requestAnimationFrame(animate);
    }
  }

  function startFireworks() {
    fireworksCanvas.style.display = 'block';
    createFireworks();
    animate();
  }

  function stopFireworks() {
    particles = [];
    cancelAnimationFrame(animationId);
    fireworksCanvas.style.display = 'none';
  }
</script>
